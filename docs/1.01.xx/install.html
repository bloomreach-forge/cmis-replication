<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2017-07-14
 | Rendered using Hippo Forge Maven Skin 1.04.00 based on Apache Maven Fluido Skin
-->
<!--[if lt IE 7]><html id="ie6" xmlns="http://www.w3.org/1999/xhtml"  xml:lang="en" lang="en"><![endif]-->
<!--[if IE 7]><html id="ie7" xmlns="http://www.w3.org/1999/xhtml"  xml:lang="en" lang="en"><![endif]-->
<!--[if IE 8]><html id="ie8" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><![endif]-->
<!--[if IE 9]><html id="ie9" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><![endif]-->
<!--[if !IE]>--><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><!--<![endif]-->

<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
                    <meta name="Date-Revision-yyyymmdd" content="20170714"/>
                <meta http-equiv="Content-Language" content="en"/>
        <title>CMIS Replication Module - 
    How to use CMIS Replication Module</title>
    <link rel="stylesheet" href="../css/forge-maven-skin-syntaxhighlighter-1.04.00.min.css"/>
    <link rel="stylesheet" href="../css/forge-maven-skin-1.04.00.min.css"/>
    <link rel="stylesheet" href="../css/site.css"/>
    <link rel="stylesheet" href="../css/print.css" media="print"/>

        
    <script type="text/javascript" src="../js/forge-maven-skin-syntaxhighlighter-1.04.00.min.js"></script>
    <script type="text/javascript" src="../js/forge-maven-skin-1.04.00.min.js"></script>

    
            </head>
    <body>

        
    
    
    <div class="container-fluid">
        <div class="row-fluid">
            <div id="header">
                <div id="logo">
                    <a href="http://www.onehippo.com">
                        <img src="../images/hipposkin/hippo-logo.png" alt="Hippo Logo" />
                    </a>
                </div>

                <h1>
                                            CMIS Replication Module
                    
                </h1>
                <div class="clearfix"></div>
            </div>
        </div>

        <div class="row-fluid">
            <div id="breadcrumbs" class="clearfix">
                <ul class="breadcrumb">
                                
                                        
                            <li id="publishDate">Last Published: 2017-07-14</li>
                                                                                                                                                </ul>

                <div class="links">
                    <a href="https://www.onehippo.com">Onehippo.com</a>
                    <a href="https://www.onehippo.org">Onehippo.org</a>
                </div>
            </div>
        </div>



            
    <div class="row-fluid">
        <div id="leftColumn" class="span3">
            <div class="well sidebar-nav">
                <ul class="nav nav-list">
                                        <li class="nav-header">Home</li>
                                                           
        <li>
    
                                                <a href="../index.html" title="Home">
                    <i class="none"></i>
                Home</a>
                    </li>
                               
        <li>
    
                                                <a href="../release-notes.html" title="Release Notes">
                    <i class="none"></i>
                Release Notes</a>
                    </li>
                                                            <li class="nav-header">Usage</li>
                                                           
        <li>
    
                                                <a href="../install.html" title="Installation">
                    <i class="none"></i>
                Installation</a>
                    </li>
                               
        <li>
    
                                                <a href="../demo-with-nuxeo-6.0.html" title="Demo with Nuxeo DM Server 6.0">
                    <i class="none"></i>
                Demo with Nuxeo DM Server 6.0</a>
                    </li>
                               
        <li>
    
                                                <a href="../build-from-source.html" title="Build from source">
                    <i class="none"></i>
                Build from source</a>
                    </li>
                                                            <li class="nav-header">1.02.xx Documentation</li>
                                                           
        <li>
    
                                                <a href="../1.02.xx/index.html" title="Home">
                    <i class="none"></i>
                Home</a>
                    </li>
                               
        <li>
    
                                                <a href="../1.02.xx/install.html" title="Installation">
                    <i class="none"></i>
                Installation</a>
                    </li>
                               
        <li>
    
                                                <a href="../1.02.xx/demo-with-nuxeo-5.6.html" title="Demo with Nuxeo DM Server 5.4">
                    <i class="none"></i>
                Demo with Nuxeo DM Server 5.4</a>
                    </li>
                                                            <li class="nav-header">1.01.xx Documentation (Deprecated)</li>
                                                           
        <li>
    
                                                <a href="../1.01.xx/index.html" title="Home">
                    <i class="none"></i>
                Home</a>
                    </li>
                               
        <li class="active">
    
                        <a href="#"><i class="none"></i>Installation</a>
                </li>
                               
        <li>
    
                                                <a href="../1.01.xx/demo-with-nuxeo-5.4.html" title="Demo with Nuxeo DM Server 5.4">
                    <i class="none"></i>
                Demo with Nuxeo DM Server 5.4</a>
                    </li>
                                                            <li class="nav-header">Project Documentation</li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
        <li>
    
                                                <a href="../project-info.html" title="Project Information">
                    <i class="icon-chevron-right"></i>
                Project Information</a>
                                </li>
                                                                                                                                                                                                                                                                                                                                                                                                                           
        <li>
    
                                                <a href="../project-reports.html" title="Project Reports">
                    <i class="icon-chevron-right"></i>
                Project Reports</a>
                                </li>
                        </ul>

                
                <hr class="divider"/>

                <div id="poweredBy">
                                            <div class="clear"></div>
                                            <div class="clear"></div>
                                            <div class="clear"></div>
                                                <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
            <img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png"/>
        </a>
                            </div>
            </div>
        </div>
    
        
        <div id="bodyColumn"  class="span9" >
                                
            <!-- Copyright 2011 Hippo Licensed under the Apache License, Version 2.0
    (the "License"); you may not use this file except in compliance with
    the License. You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0 Unless required by
    applicable law or agreed to in writing, software distributed under
    the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES
    OR CONDITIONS OF ANY KIND, either express or implied. See the
    License for the specific language governing permissions and
    limitations under the License. -->
  
    <div class="section">
<h2>How to use CMIS Replication Module<a name="How_to_use_CMIS_Replication_Module"></a></h2>
      
<div class="section">
<h3>Prerequisites<a name="Prerequisites"></a></h3>
        
<p>
          These instruction assumes that you have maven 2 or 3 based build for your site.
        </p>
      </div>
      
<div class="section">
<h3>Maven 2 repository<a name="Maven_2_repository"></a></h3>
        
<p>Add this repository to your root pom.xml:</p>
        
<div class="source"><pre class="prettyprint linenums">
    &lt;repository&gt;
      &lt;id&gt;hippo-maven2-forge&lt;/id&gt;
      &lt;name&gt;Hippo Maven 2 Forge&lt;/name&gt;
      &lt;url&gt;http://maven.onehippo.com/maven2-forge&lt;/url&gt;
    &lt;/repository&gt;</pre></div>
      </div>

      
<div class="section">
<h3>Specifying the dependency in a CMS/Repository Application project<a name="Specifying_the_dependency_in_a_CMSRepository_Application_project"></a></h3>
        
<p>
          Add the following dependency in your CMS/Repository Application project.
          CMIS Replication Module depends on Spring Daemon Module. So, you should add
          Spring Framework dependencies.
          One of the simplest ways to include Spring Framework dependency is to use
          HST-2's Spring Dependency POM dependency as described below.
        </p>
        
<div class="source"><pre class="prettyprint linenums">
    &lt;!-- CMIS Replication requires Spring Daemon Module --&gt;
    
    &lt;dependency&gt;
      &lt;groupId&gt;org.onehippo.cms7.hst.dependencies&lt;/groupId&gt;
      &lt;artifactId&gt;hst-spring-dependencies&lt;/artifactId&gt;
      &lt;type&gt;pom&lt;/type&gt;
      &lt;version&gt;${hippo.hst.version}&lt;/version&gt;
    &lt;/dependency&gt;
    
    &lt;!-- Spring Daemon Module dependency --&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.onehippo.forge.springdaemon&lt;/groupId&gt;
      &lt;artifactId&gt;springdaemon&lt;/artifactId&gt;
      &lt;version&gt;${forge.springdaemon.version}&lt;/version&gt;
    &lt;/dependency&gt;
    
    &lt;!-- CMIS Replication Module --&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.onehippo.forge.cmisreplication&lt;/groupId&gt;
      &lt;artifactId&gt;cmisreplication&lt;/artifactId&gt;
      &lt;version&gt;${forge.cmisreplication.version}&lt;/version&gt;
    &lt;/dependency&gt;
        </pre></div>
        
<p>
          With the dependency addtion of CMIS Replication Module,
          an asset document replicated from CMIS Repository will be of the following type:
        </p>
        
<div class="source"><pre class="prettyprint linenums">
&lt;hippogallery='http://www.onehippo.org/jcr/hippogallery/nt/2.0'&gt;
&lt;cmisreplication='http://www.onehippo.org/jcr/cmis/cmisreplication/nt/1.0'&gt;

[cmisreplication:exampleAssetSet] &gt; hippogallery:exampleAssetSet
- cmisreplication:objectId (string)
- cmisreplication:name (string)
- cmisreplication:createdBy (string)
- cmisreplication:creationDate (date)
- cmisreplication:lastModifiedBy (string)
- cmisreplication:lastModificationDate (date)
- cmisreplication:versionLabel (string)
- * (string) 
- * (string) multiple
- * (boolean) 
- * (boolean) multiple
- * (long) 
- * (long) multiple
- * (double) 
- * (double) multiple
- * (date) 
- * (date) multiple
        </pre></div>
        
<p>
          All the new property definitions with 'cmisreplication' prefix are for CMIS Document Metadata.
          Also, if you want to customize the replicator POJO bean, you may add any other properties easily
          because it already contains anonymous property definitions.
        </p>
      </div>
      
      
<div class="section">
<h3>Add your POJO beans with Leveraging Spring Framework Components<a name="Add_your_POJO_beans_with_Leveraging_Spring_Framework_Components"></a></h3>
        
<p>
          Add a resource, classpath:org/onehippo/forge/springdaemon/SpringDaemonModule.xml.
          Normally, you can add a file under /WEB-INF/classes/ to override the configuration.
        </p>
        
<div class="source"><pre class="prettyprint linenums">
&lt;!-- classpath:org/onehippo/forge/springdaemon/SpringDaemonModule.xml --&gt;

&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot; 
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd&quot;&gt;
  
  &lt;!-- Import demo scheduler --&gt;
  &lt;import resource=&quot;classpath:org/onehippo/forge/cmisreplication/cmis-replication-scheduler.xml&quot; /&gt;
  
&lt;/beans&gt;
        </pre></div>
        
<p>
          In the configuration above, a separated scheduler configuration, cmis-replication-scheduler.xml,
          can be added somewhere. You can choose any location. 
        </p>
        
<div class="source"><pre class="prettyprint linenums">
&lt;!-- classpath:org/onehippo/forge/cmisreplication/cmis-replication-scheduler.xml --&gt;

&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot; 
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xmlns:task=&quot;http://www.springframework.org/schema/task&quot;
       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
                           http://www.springframework.org/schema/task http://www.springframework.org/schema/task/spring-task-3.0.xsd&quot;&gt;
  
  &lt;!-- To use an external properties file, put Spring's built-in PropertyPlaceholderConfigurator here. --&gt;
  &lt;bean class=&quot;org.springframework.beans.factory.config.PropertyPlaceholderConfigurer&quot;&gt;
    &lt;!-- You can use any configuration properties file location --&gt;
    &lt;property name=&quot;location&quot; value=&quot;classpath:org/onehippo/forge/cmisreplication/cmis-replication-scheduler.properties&quot; /&gt;
  &lt;/bean&gt;
  
  &lt;!-- Put Spring Daemon's built-in SessionAware bean which provides JCR session through #getSession() --&gt;
  &lt;bean id=&quot;jcrSessionProvider&quot; class=&quot;org.onehippo.forge.springdaemon.SessionProvider&quot; /&gt;
  
  &lt;!-- The CMIS Documents Replicator POJO Bean --&gt;
  &lt;bean id=&quot;cmisDocumentsReplicator&quot; class=&quot;org.onehippo.forge.cmisreplication.CmisDocumentsReplicator&quot;&gt;
    &lt;property name=&quot;jcrSession&quot;&gt;
      &lt;bean class=&quot;org.springframework.beans.factory.config.PropertyPathFactoryBean&quot;&gt;
        &lt;property name=&quot;targetObject&quot; ref=&quot;jcrSessionProvider&quot; /&gt;
        &lt;property name=&quot;propertyPath&quot; value=&quot;session&quot; /&gt;
      &lt;/bean&gt;
    &lt;/property&gt;
    &lt;property name=&quot;cmisRepoConfig&quot;&gt;
      &lt;bean class=&quot;org.onehippo.forge.cmisreplication.CmisRepoConfig&quot;&gt;
        &lt;property name=&quot;url&quot; value=&quot;${cmis.replication.source.url}&quot; /&gt;
        &lt;property name=&quot;username&quot; value=&quot;${cmis.replication.source.username}&quot; /&gt;
        &lt;property name=&quot;password&quot; value=&quot;${cmis.replication.source.password}&quot; /&gt;
        &lt;property name=&quot;repositoryId&quot; value=&quot;${cmis.replication.source.repositoryId}&quot; /&gt;
        &lt;property name=&quot;rootPath&quot; value=&quot;${cmis.replication.source.rootPath}&quot; /&gt;
        &lt;property name=&quot;maxItemsPerPage&quot; value=&quot;500&quot; /&gt;
        &lt;property name=&quot;skipCount&quot; value=&quot;0&quot; /&gt;
      &lt;/bean&gt;
    &lt;/property&gt;
    &lt;property name=&quot;hippoRepoConfig&quot;&gt;
      &lt;bean class=&quot;org.onehippo.forge.cmisreplication.HippoRepoConfig&quot;&gt;
        &lt;property name=&quot;rootPath&quot; value=&quot;${cmis.replication.target.rootPath}&quot; /&gt;
      &lt;/bean&gt;
    &lt;/property&gt;
    &lt;property name=&quot;updateCmisDocumentsToRepository&quot; value=&quot;${cmis.replication.updateCmisDocumentsToRepository}&quot; /&gt;
    &lt;property name=&quot;updateRepositoryDocumentsToCmis&quot; value=&quot;${cmis.replication.updateRepositoryDocumentsToCmis}&quot; /&gt;
  &lt;/bean&gt;
  
  &lt;!-- Simple Task Scheduler Task configuration which executes the POJO, cmisDocumentsReplicator. --&gt;
  &lt;task:scheduled-tasks scheduler=&quot;cmisDocImportingScheduler&quot;&gt;
    &lt;task:scheduled ref=&quot;cmisDocumentsReplicator&quot; method=&quot;execute&quot; fixed-delay=&quot;${cmis.replication.execution.delay}&quot; /&gt;
  &lt;/task:scheduled-tasks&gt;
  
  &lt;!-- Simple Java Task Executor scheduler configuration --&gt;
  &lt;task:scheduler id=&quot;cmisDocImportingScheduler&quot; pool-size=&quot;1&quot; /&gt;

&lt;/beans&gt;
        </pre></div>
        
<p>
          In the example scheduler configuration above, we added the simple POJO, cmisDocumentsReplicator,
          which basically replicates/synchronizes from CMIS Repository to Hippo Repository.
          This bean can be just copied and pasted in your project.
        </p>
        
<div class="source"><pre class="prettyprint linenums">
# classpath:org/onehippo/forge/cmisreplication/cmis-replication-scheduler.properties

# CMIS Replication Scheduler Execution Fixed Delay Time in Milliseconds
cmis.replication.execution.delay = 10000
# CMIS Replication Source CMIS URL
cmis.replication.source.url = http://localhost:8080/nuxeo/atom/cmis
# CMIS Replication Source CMIS Repository ID
cmis.replication.source.repositoryId = default
# CMIS Replication Source CMIS Repository Credentials
cmis.replication.source.username = Administrator
cmis.replication.source.password = Administrator
# CMIS Replication Source CMIS Repository Root Path where documents are replicated from.
cmis.replication.source.rootPath = /default-domain/sections/marketing
# CMIS Replication Target Hippo Repository Root Path where documents are replicated to.
cmis.replication.target.rootPath = /content/assets/marketing
# Flag whether the replication from source to target is on/off
cmis.replication.updateCmisDocumentsToRepository = true
# Flag whether the replication from target to source is on/off; 
# When turned on, deleting an asset from Hippo Repository triggers deleting the corresponding document in CMIS Repository.
cmis.replication.updateRepositoryDocumentsToCmis = false
        </pre></div>
        
<p>
          To externalize the configuration, we have a separated properties file
          which is used by the Spring's built-in PropertyPlaceholderConfigurer.
        </p>
        
<p>
          For the POJO, cmisDocumentsReplicator, you can configure the following properties as shown above:
        </p>
        
<table border="0" class="table table-striped">
          
<tr class="a">
            
<th>Property Path</th>
            
<th>Description</th>
            
<th>Example Value</th>
            
<th>Default Value</th>
          </tr>
          
<tr class="b">
            
<td>jcrSession</td>
            
<td>
              The JCR Session used to connect to Hippo Repository.
              The JCR Session is always given to a bean implementing SessionAware interface by the Spring Daemon Module.
              In the example configuration above, the built-in SessionProvider bean implements SessionAware, so
              we just use #getSession() property getter to inject JCR Session.
            </td>
            
<td></td>
            
<td></td>
          </tr>
          
<tr class="a">
            
<td>cmisRepoConfig.url</td>
            
<td>CMIS Repository Server URL</td>
            
<td>http://localhost:8080/nuxeo/atom/cmis</td>
            
<td></td>
          </tr>
          
<tr class="b">
            
<td>cmisRepoConfig.username</td>
            
<td>The user name for CMIS Repository</td>
            
<td>Administrator</td>
            
<td></td>
          </tr>
          
<tr class="a">
            
<td>cmisRepoConfig.password</td>
            
<td>The password for CMIS Repository</td>
            
<td>Administrator</td>
            
<td></td>
          </tr>
          
<tr class="b">
            
<td>cmisRepoConfig.repositoryId</td>
            
<td>The Repository ID of the CMIS Repository</td>
            
<td>default</td>
            
<td></td>
          </tr>
          
<tr class="a">
            
<td>cmisRepoConfig.rootPath</td>
            
<td>The source CMIS Repository Document Path where documents are replicated from</td>
            
<td>/default-domain/sections/marketing</td>
            
<td></td>
          </tr>
          
<tr class="b">
            
<td>cmisRepoConfig.maxItemsPerPage</td>
            
<td>The max item count which is configured to Open CMIS Operation Context API</td>
            
<td>500</td>
            
<td>100</td>
          </tr>
          
<tr class="a">
            
<td>cmisRepoConfig.skipCount</td>
            
<td>The skip count which is configured to Open CMIS Operation Context API</td>
            
<td>0</td>
            
<td>0</td>
          </tr>
          
<tr class="b">
            
<td>hippoRepoConfig.rootPath</td>
            
<td>The target Hippo Repository Asset Documents Path where documents are replicated to</td>
            
<td>/content/assets/marketing</td>
            
<td></td>
          </tr>
          
<tr class="a">
            
<td>updateCmisDocumentsToRepository</td>
            
<td>Flag whether the replication from source to target is on/off</td>
            
<td>true</td>
            
<td>false</td>
          </tr>
          
<tr class="b">
            
<td>updateRepositoryDocumentsToCmis</td>
            
<td>
              Flag whether the replication from target to source is on/off; 
              When turned on, deleting an asset from Hippo Repository triggers deleting the corresponding document in CMIS Repository.
            </td>
            
<td>false</td>
            
<td>false</td>
          </tr>
        </table>
      </div>
    </div>
  

            </div>
        </div>
    </div>

    <hr/>

    <footer>
                <div class="container-fluid">
                <div class="row span12">Copyright &copy;                                                2017.
                        All Rights Reserved.            
                                        
            </div>

        
        
                </div>
    </footer>
</body>
</html>
